
@model FrontendSecure.Models.CustomerAssetypeViewModel

@{
    ViewBag.Title = Model.Customer.Firm;
    <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
    @Html.DevExpress().GetStyleSheets(
        new StyleSheet { ExtensionSuite = ExtensionSuite.NavigationAndLayout },
        new StyleSheet { ExtensionSuite = ExtensionSuite.Editors },
        new StyleSheet { ExtensionSuite = ExtensionSuite.GridView }
    )
    @Html.DevExpress().GetScripts(
        new Script { ExtensionSuite = ExtensionSuite.NavigationAndLayout },
        new Script { ExtensionSuite = ExtensionSuite.Editors },
        new Script { ExtensionSuite = ExtensionSuite.GridView }
    )

}

<div id="customerDiv">
    <h2>@Model.Customer.Firm</h2>
    <hr />
    <dl class="dl-horizontal">
        <dt>
            @Html.DisplayNameFor(model => model.Customer.Address)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Customer.Address)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Customer.Date)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Customer.Date)
        </dd>

    </dl>
    <ul class="nav nav-tabs">
        <li role="presentation" class="active" onclick="TabShift()" id="AssetPane">
            <a href="#Asset" data-toggle="tab" id="idAsset">Udstyr</a>
        </li>
        <li role="presentation" onclick="TabShift()" id="UserPane">
            <a href="#User" data-toggle="tab" id="idUser">Brugere</a>
        </li>
    </ul>
</div>
<div class="container-fluid" style="overflow-x: auto;">
    <div class="tab-content" style="overflow-x: auto;">
        <div class="tab-pane active" id="Asset" style="overflow-x: auto;">
            <div style="display: none">
                @*<div style="overflow-x: auto;">

                <div id="sideBarTypes">
                    <h5>Typer</h5>
                    <ul class="nav nav-stacked">
                        @foreach (var type in Model.AssetTypes)
                        {
                            if (type.Assets != null && type.Assets.Count > 0)
                            {
                                <li onclick="SortAsset(this)" data-id="@type.Id" id="stylingTypes">
                                    <div id="typeListItems">
                                        @type.Description
                                    </div>


                                </li>
                            }

                        }
                        <li onclick="SortAsset(this)" data-id="All" id="stylingTypesbtn">Vis alle</li>
                    </ul>
                </div>

                <br/>

                    <a id="addBtn" class="btn btn-default" href="@Url.Action("CreateAsset", "Customers", new {id = Model.Customer.Id})">
                        <span class="glyphicon glyphicon-plus"
                              aria-hidden="true"></span>
                        <b>Udstyr</b>
                    </a>

                        <div id="assetTableMidle">
                            <div class="col-10">

                                <table id="assetTable" class="table table-striped table-hover sortable">
                                    <tr id="hideHeaders">

                                        <th>
                                            Navn
                                        </th>

                                        <th>
                                            Bruger
                                        </th>
                                        <th>
                                            Notat
                                        </th>
                                        <th>
                                            Type
                                        </th>
                                        <th>
                                            Login
                                        </th>
                                        <th>
                                            Password
                                        </th>
                                        <th >
                                            IP Adresse

                                        </th>
                                        <th></th>
                                    </tr>

                                        @foreach (var item in Model.SortedAssets)
                                        {
                                            <tr id="@item.Type.Id">

                                                <td onclick="showPageLoadingSpinner()">
                                                    @Html.ActionLink(item.Name, "AssetDetails", new { id = item.Id, customerId = Model.Customer.Id })
                                                </td>
                                                <td>
                                                    @Html.DisplayFor(modelItem => item.Usedby)
                                                </td>
                                                <td>
                                                    @Html.DisplayFor(modelItem => item.Note)
                                                </td>
                                                <td>
                                                    @Html.DisplayFor(modelItem => item.Type.Description)
                                                </td>
                                                <td>
                                                    @Html.DisplayFor(modelItem => item.Login)
                                                </td>
                                                <td onmouseover="this.innerHTML = '@item.Password';" onmouseout="
                                                    this.innerHTML='••••••' ;">
                                                    ••••••
                                                </td>
                                                <td>
                                                    @Html.DisplayFor(modelItem => item.IpAddress)
                                                </td>
                                                <td align="right" id="alignBtn">
                                                    <a class="btn btn-success" href="@Url.Action("AssetDetails", "Customers", new {id = item.Id, customerId = Model.Customer.Id})" onclick="showPageLoadingSpinner()">
                                                        <span class="glyphicon glyphicon-eye-open"
                                                              aria-hidden="true"></span>
                                                    </a>
                                                    <a class="btn btn-default" href="@Url.Action("Edit", "Assets", new {id = item.Id})" onclick="showPageLoadingSpinner()">
                                                        <span class="glyphicon glyphicon-pencil"
                                                              aria-hidden="true"></span>
                                                    </a>
                                                    <a class="btn btn-danger" onclick="deleteClick(this)" data-id="@item.Id" data-name="@item.Name">

                                                        <span class="glyphicon glyphicon-trash"
                                                              aria-hidden="true"></span>
                                                    </a>
                                                </td>
                                            </tr>
                                        }


                                </table>


                            </div>
                        </div>
            </div>*@
            </div>
       
        

            @Html.Action("AssetTableExpressPartial", "Assets", new {customerid = Model.Customer.Id})



        
        </div>
       
        
        <div id="User" class="tab-pane">
            
            <div style="display: none">
                
                @*<table class="table table-striped table-hover sortable">
                    <tr id="hideHeadersUsers">
                        <th>Fornavn</th>
                        <th>Efternavn</th>
                        <th>Email</th>
                        <th>Telefon nr.</th>
                        <th>Password</th>
                        <th></th>
                    </tr>
                    @foreach (var item in Model.Users)
                    {
                        <tr>
                            <td>@Html.DisplayFor(modelItem => item.FirstName)</td>
                            <td>@Html.DisplayFor(modelItem => item.LastName)</td>
                            <td>@Html.DisplayFor(modelItem => item.Email)</td>
                            <td>@Html.DisplayFor(modelItem => item.PhoneNumber)</td>
                            <td onmouseover="this.innerHTML = '@item.Password';" onmouseout="this.innerHTML = '••••••';">
                                ••••••
                            </td>

                            <td align="right" id="alignBtnUsers">
                                <a class="btn btn-default" href="@Url.Action("Edit", "Users", new {id = item.Id})" onclick="showPageLoadingSpinner()">
                                    <span class="glyphicon glyphicon-pencil"
                                          aria-hidden="true"></span>
                                </a>
                                <a class="btn btn-danger" onclick="deleteUserClick(this)" data-id="@item.Id" data-name="@item.FirstName">

                                    <span class="glyphicon glyphicon-trash"
                                          aria-hidden="true"></span>

                                </a>

                            </td>
                        </tr>
                    }
                    <tr>
                        <td id="tdForUser" onclick="showPageLoadingSpinner()">
                            <a id="addUsersBtn" class="btn btn-default" href="@Url.Action("Create", "Users", new {CustomerId = Model.Customer.Id})">
                                <span class="glyphicon glyphicon-plus"
                                      aria-hidden="true"></span>
                                <b>Brugere</b>
                            </a>
                        </td>
                        <td id="tdDisable8"></td>
                        <td id="tdDisable9"></td>
                        <td id="tdDisable10"></td>
                        <td id="tdDisable11"></td>
                        <td id="tdDisable12"></td>
                        <td id="tdDisable13"></td>
                    </tr>
                </table>*@
            </div>
        

            @Html.Action("UsersTableExpressPartial", "Users", new { customerId = Model.Customer.Id})



        
        </div>
    </div>
</div>


<p id="goBack" onclick="showPageLoadingSpinner()" >
    @Html.ActionLink("Tilbage", "Index")
</p>

<script type="text/javascript">
    $globalurl = '';
    //delete assets
    function deleteClick(e) {
        $globalurl = '@Url.Action("ModifiedDelete", "Assets")';
        $globalid = $(e).data('id');
        $("#popupBackground").show();
        $("#popup")
            .toggle("fast",
                function () {
                    document.getElementById('name').innerHTML = $(e).data('name');
                    console.log("bind to hide");
                    $('#popupBackground')
                       .bind('click', function () {
                           HidePopup();
                       });
                });
    }

    $("#noButton")
        .click(function () {
            $("#popup")
                .toggle("fast",
                    function () {
                        $("#popupBackground").hide();
                    });
        });
    $("#yesButton")
        .click(function () {
            $("#popupBackground").unbind('click');
            $("#popup")
                .toggle("fast",
                    function () {
                        $.ajax({
                            type: "POST",
                            url: $globalurl,
                            data: { id: $globalid },
                            success: function (data) {
                                if (data) {
                                    location.reload();
                                }
                                else {
                                    alert("Something went wrong")
                                }
                            },
                            failure: function (data) {
                                alert("Try reloading the page");
                            },

                            error: function (data) {
                                console.log("ERROR");
                            }
                        });
                    });
        });
    //Delete users
    function deleteUserClick(e) {
        $globalurl = '@Url.Action("AjaxDeleteConfirmed", "Users")'
        $globalid = $(e).data('id');
        $("#popup")
            .toggle("fast",
                function () {

                    document.getElementById('name').innerHTML = $(e).data('name');
                    $('#popupBackground')
                        .bind(HidePopup);


                });
    }
    function HidePopup() {
        $("#popup")
            .toggle('fast',
                function () {
                    $("#popupBackground").hide();
                    $("#popupBackground").unbind('click');
                });
    }

    function TabShift() {
        setTimeout(function () {
            localStorage.setItem("paneactive", $("ul.nav-tabs li.active ").attr("id"));
            var element = document.querySelector(".tab-content .active");
            localStorage.setItem("contentactive", $(element).attr("id"));
            console.log(localStorage.getItem("contentactive"));
        }, 400);


    }

    $(document)
        .ready(function () {
            var id = localStorage.getItem("paneactive");
            var element = document.getElementById(id);
            $(element).addClass('active').siblings().removeClass('active');

            var id2 = localStorage.getItem("contentactive");
            var element2 = document.getElementById(id2);
            $(element2).addClass('active').siblings().removeClass('active');


        });

    function SortAsset(e) {
        var typeid = $(e).attr('data-id');
        var rows = $("#assetTable").children('tbody').children('tr');
        var count = $(rows).length;
        console.log(count);
        $(rows).each(function () {
            if (typeid == "All") {
                $(this).show();
                return true;
            }
            var elementId = $(this).attr('id');
            $(this).show();
            if (elementId != typeid) {
                $(this).hide();
            }

        });
    }
    
</script>