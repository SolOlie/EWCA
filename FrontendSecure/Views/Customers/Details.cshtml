
@model FrontendSecure.Models.CustomerAssetypeViewModel

@{
    ViewBag.Title = Model.Customer.Firm;
    <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
}

@section styles{
    <link href="~/Content/CustomerDetailsStyles.css" rel="stylesheet" />
}

<div id="customerDiv">
    <h2>@Model.Customer.Firm</h2>
    <hr />
    <dl class="dl-horizontal">
        <dt>
            @Html.DisplayNameFor(model => model.Customer.Address)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Customer.Address)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Customer.Date)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Customer.Date)
        </dd>

    </dl>
    <ul class="nav nav-tabs">
        <li role="presentation" class="active" onclick="TabShift()" id="AssetPane">
            <a href="#Asset" data-toggle="tab" id="idAsset">Udstyr</a>
        </li>
        <li role="presentation" onclick="TabShift()" id="UserPane">
            <a href="#User" data-toggle="tab" id="idUser">Brugere</a>
        </li>
    </ul>
</div>
<div class="container-fluid">
    <div class="tab-content">
        <div class="tab-pane active" id="Asset">

            <div style="overflow-x: auto;">
                <table class="table" id="Detailstable">
                    <tr>
                        <td id="sideBarTypes">
                            <h5>Typer</h5>
                            <ul class="nav nav-stacked">
                                @foreach (var type in Model.AssetTypes)
                                {
                                    if (type.Assets != null && type.Assets.Count > 0)
                                    {
                                        <li onclick="SortAsset(this)" data-id="@type.Id" id="stylingTypes">
                                            <div id="typeListItems">
                                                @type.Description
                                            </div>


                                        </li>
                                    }

                                }
                                <li onclick="SortAsset(this)" data-id="All" id="stylingTypesbtn">Vis alle</li>
                            </ul>
                        </td>
                        <td id="assetTableMidle">
                            <div class="col-12">

                                <table class="table table-striped table-hover" id="SortTables">
                                    <tr id="hideHeaders">

                                        <th onclick="sortTable(0)">
                                            Navn
                                        </th>

                                        <th>
                                            Bruger
                                        </th>
                                        <th>
                                            Notat
                                        </th>
                                        <th>
                                            Type
                                        </th>
                                        <th>
                                            Login
                                        </th>
                                        <th>
                                            Password
                                        </th>
                                        <th onclick="sortTable(1)">
                                            IP Adresse

                                        </th>
                                        <th></th>
                                    </tr>
                                    <tbody id="assetTable">
                                        @foreach (var item in Model.SortedAssets)
                                        {
                                            <tr id="@item.Type.Id">

                                                <td onclick="showPageLoadingSpinner()">
                                                    @Html.ActionLink(item.Name, "AssetDetails", new { id = item.Id, customerId = Model.Customer.Id })
                                                </td>
                                                <td>
                                                    @Html.DisplayFor(modelItem => item.Usedby)
                                                </td>
                                                <td>
                                                    @Html.DisplayFor(modelItem => item.Note)
                                                </td>
                                                <td>
                                                    @Html.DisplayFor(modelItem => item.Type.Description)
                                                </td>
                                                <td>
                                                    @Html.DisplayFor(modelItem => item.Login)
                                                </td>
                                                <td onmouseover="this.innerHTML = '@item.Password';" onmouseout="
                                                    this.innerHTML='••••••' ;">
                                                    ••••••
                                                </td>
                                                <td>
                                                    @Html.DisplayFor(modelItem => item.IpAddress)
                                                </td>
                                                <td align="right" id="alignBtn">
                                                    <a class="btn btn-success" href="@Url.Action("AssetDetails", "Customers", new {id = item.Id, customerId = Model.Customer.Id})" onclick="showPageLoadingSpinner()">
                                                        <span class="glyphicon glyphicon-eye-open"
                                                              aria-hidden="true"></span>
                                                    </a>
                                                    <a class="btn btn-default" href="@Url.Action("Edit", "Assets", new {id = item.Id})" onclick="showPageLoadingSpinner()">
                                                        <span class="glyphicon glyphicon-pencil"
                                                              aria-hidden="true"></span>
                                                    </a>
                                                    <a class="btn btn-danger" onclick="deleteClick(this)" data-id="@item.Id" data-name="@item.Name">

                                                        <span class="glyphicon glyphicon-trash"
                                                              aria-hidden="true"></span>
                                                    </a>
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                    <tr>
                                        <td id="tdForAddAsset">
                                            <div id="addAssetBtnOnSmallerDevices">
                                                <a id="addBtn" class="btn btn-default" href="@Url.Action("CreateAsset", "Customers", new {id = Model.Customer.Id})">
                                                    <span class="glyphicon glyphicon-plus"
                                                          aria-hidden="true"></span>
                                                    <b>Udstyr</b>
                                                </a>
                                            </div>
                                        </td>
                                        <td id="tdDisable14"></td>
                                        <td id="tdDisable15"></td>
                                        <td id="tdDisable16"></td>
                                        <td id="tdDisable17"></td>
                                        <td id="tdDisable18"></td>
                                        <td id="tdDisable19"></td>
                                        <td id="tdDisable20"></td>
                                    </tr>
                                </table>


                            </div>
                        </td>
                    </tr>
                </table>

            </div>
        </div>
        <div id="User" class="tab-pane">

            <table class="table table-striped table-hover">
                <tr id="hideHeadersUsers">
                    <th>Fornavn</th>
                    <th>Efternavn</th>
                    <th>Email</th>
                    <th>Telefon nr.</th>
                    <th>Password</th>
                    <th></th>
                </tr>
                @foreach (var item in Model.Users)
                {
                    <tr>
                        <td>@Html.DisplayFor(modelItem => item.FirstName)</td>
                        <td>@Html.DisplayFor(modelItem => item.LastName)</td>
                        <td>@Html.DisplayFor(modelItem => item.Email)</td>
                        <td>@Html.DisplayFor(modelItem => item.PhoneNumber)</td>
                        <td onmouseover="this.innerHTML = '@item.Password';" onmouseout="this.innerHTML = '••••••';">
                            ••••••
                        </td>

                        <td align="right" id="alignBtnUsers" >
                            <a class="btn btn-default" href="@Url.Action("Edit", "Users", new {id = item.Id})"onclick="showPageLoadingSpinner()">
                                <span class="glyphicon glyphicon-pencil"
                                      aria-hidden="true"></span>
                            </a>
                            <a class="btn btn-danger" onclick="deleteUserClick(this)" data-id="@item.Id" data-name="@item.FirstName">

                                <span class="glyphicon glyphicon-trash"
                                      aria-hidden="true"></span>

                            </a>

                        </td>
                    </tr>
                }
                <tr>
                    <td id="tdForAddUser" onclick="showPageLoadingSpinner()">
                        <a id="addUsersBtn" class="btn btn-default" href="@Url.Action("Create", "Users", new {CustomerId = Model.Customer.Id})">
                            <span class="glyphicon glyphicon-plus"
                                  aria-hidden="true"></span>
                            <b>Brugere</b>
                        </a>
                    </td>
                    <td id="tdDisable8"></td>
                    <td id="tdDisable9"></td>
                    <td id="tdDisable10"></td>
                    <td id="tdDisable11"></td>
                    <td id="tdDisable12"></td>
                    <td id="tdDisable13"></td>
                </tr>
            </table>

        </div>
    </div>
</div>
<div id="popupBackground"></div>
<div id="popup">

    <p id="popupPTag">
        Ønsker du at slette?
    <p id="name">

    </p>

    <a class="btn btn-success" id="yesButton" onclick="showPageLoadingSpinner()"><span class="glyphicon glyphicon-ok"></span></a>
    <a class="btn btn-danger" id="noButton"><span class="glyphicon glyphicon-remove"></span></a>
</div>

<p id="goBack" onclick="showPageLoadingSpinner()" >
    @Html.ActionLink("Tilbage", "Index")
</p>

<script type="text/javascript">
    $globalurl = '';
    //delete assets
    function deleteClick(e) {
        $globalurl = '@Url.Action("ModifiedDelete", "Assets")';
        $globalid = $(e).data('id');
        $("#popupBackground").show();
        $("#popup")
            .toggle("fast",
                function () {
                    document.getElementById('name').innerHTML = $(e).data('name');
                    console.log("bind to hide");
                    $('#popupBackground')
                       .bind('click', function () {
                           HidePopup();
                       });
                });
    }

    $("#noButton")
        .click(function () {
            $("#popup")
                .toggle("fast",
                    function () {
                        $("#popupBackground").hide();
                    });
        });
    $("#yesButton")
        .click(function () {
            $("#popupBackground").unbind('click');
            $("#popup")
                .toggle("fast",
                    function () {
                        $.ajax({
                            type: "POST",
                            url: $globalurl,
                            data: { id: $globalid },
                            success: function (data) {
                                if (data) {
                                    location.reload();
                                }
                                else {
                                    alert("Something went wrong")
                                }
                            },
                            failure: function (data) {
                                alert("Try reloading the page");
                            },

                            error: function (data) {
                                console.log("ERROR");
                            }
                        });
                    });
        });
    //Delete users
    function deleteUserClick(e) {
        $globalurl = '@Url.Action("AjaxDeleteConfirmed", "Users")'
        $globalid = $(e).data('id');
        $("#popup")
            .toggle("fast",
                function () {

                    document.getElementById('name').innerHTML = $(e).data('name');
                    $('#popupBackground')
                        .bind(HidePopup);


                });
    }
    function HidePopup() {
        $("#popup")
            .toggle('fast',
                function () {
                    $("#popupBackground").hide();
                    $("#popupBackground").unbind('click');
                });
    }

    function TabShift() {
        setTimeout(function () {
            localStorage.setItem("paneactive", $("ul.nav-tabs li.active ").attr("id"));
            var element = document.querySelector(".tab-content .active");
            localStorage.setItem("contentactive", $(element).attr("id"));
            console.log(localStorage.getItem("contentactive"));
        }, 400);


    }

    $(document)
        .ready(function () {
            var id = localStorage.getItem("paneactive");
            var element = document.getElementById(id);
            $(element).addClass('active').siblings().removeClass('active');

            var id2 = localStorage.getItem("contentactive");
            var element2 = document.getElementById(id2);
            $(element2).addClass('active').siblings().removeClass('active');


        });

    function SortAsset(e) {
        var typeid = $(e).attr('data-id');
        var rows = $("#assetTable").children('tr');
        $(rows).each(function () {
            if (typeid == "All") {
                $(this).show();
                return true;
            }
            var elementId = $(this).attr('id');
            $(this).show();
            if (elementId != typeid) {
                $(this).hide();
            }

        });
    }
    function sortTable(n) {
        var table, rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
        table = document.getElementById("SortTables");
        switching = true;
        dir = "asc";
        while (switching) {
            switching = false;
            rows = table.getElementsByTagName("tr");
            for (i = 1; i < (rows.length - 2) ; i++) {
                shouldSwitch = false;
                x = rows[i].getElementsByTagName("td")[n];
                y = rows[i + 1].getElementsByTagName("td")[n];
                if (dir == "asc") {
                    if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
                        shouldSwitch = true;
                        break;
                    }
                } else if (dir == "desc") {
                    if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
                        shouldSwitch = true;
                        break;
                    }
                }
            }
            if (shouldSwitch) {

                rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                switching = true;
                switchcount++;
            } else {
                if (switchcount == 0 && dir == "asc") {
                    dir = "desc";
                    switching = true;
                }
            }
        }
    }
</script>