@model FrontendSecure.Models.CreateCustomerModel

@{
    ViewBag.Title = "Create";

}
@section styles
{
    <link href="~/Content/CreateCostumer.css" rel="stylesheet" />
}
<h2></h2>


@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()

    <div class="form-horizontal">
        <h4></h4>
        <hr />
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        <div class="form-group">
            @Html.LabelFor(model => model.Customer.Firm, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.Customer.Firm, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.Customer.Firm, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.Customer.Address, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.Customer.Address, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.Customer.Address, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.Customer.Date, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.Customer.Date, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.Customer.Date, "", new { @class = "text-danger" })
            </div>
        </div>
        <div class="form-group">
            @Html.LabelFor(model => model.Customer.ContactPersons, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                <select class="selectpicker show-menu-arrow" multiple id="selectableUsers" name="ids">
                    @if (Model.Users != null && Model.Users.Count > 0)
                    {
                        foreach (var c in Model.Users)
                        {
                            <option data-id="@c.Id" value="@c.Id">@c.FirstName</option>
                        }
                    }
                </select>

                <a class="btn btn-default" id="addContactPerson" onclick="AddClick()">
                    <span class="glyphicon glyphicon-plus"></span>
                </a>
                <ul>
                    @if (Model.Customer.ContactPersons != null && Model.Customer.ContactPersons.Count > 0)
                    {
                        foreach (var c in Model.Customer.ContactPersons)
                        {
                            <li>@c.FirstName</li>
                        }
                    }
                </ul>
            </div>

        </div>

        <div id="popupAddContact">
            <input id="firstName" placeholder="First name" />
            <input id="lastName" placeholder="Last name" />
            <input id="email" placeholder="Email" />
            <input id="phoneNumber" placeholder="Phone number" />
            <input id="password" placeholder="Password" />
            <a id="btnAddContact" class="btn btn-success"onclick="AddContactClick()">Add</a>
            <a id="addContactPersonCancel" class="btn btn-danger" onclick="CancelClick()">Cancel</a>

        </div>
        <div class="form-group">
            <div class="col-md-offset-2 col-md-10">
                <input type="submit" value="Create" class="btn btn-default" />
            </div>
        </div>
    </div>
}

<div onclick="showPageLoadingSpinner()">
    @Html.ActionLink("Back to List", "Index")
</div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
}
<script type="text/javascript">
    function AddClick() {
        $("#popupAddContact")
            .toggle("fast", function () {

            });
    };
    function CancelClick() {
        $("#popupAddContact")
            .toggle("fast", function () {

            });
    };

    function AddContactClick() {
        $("#popupAddContact")
             .toggle("fast", function () {
                var FName = $("#firstName").val();
                var LName = $("#lastName").val();
                var Email = $("#email").val();
                var Pass = $("#password").val();
                 $.ajax({
                     type: "POST",
                     url: '@Url.Action("AjaxCreateConfirmed", "Users")',
                     data: {
                         Email: Email,
                         FirstName: FName,
                         LastName: LName,
                         Password: Pass 
                     },
                     success: function (data) {
                         if (data) {
                             location.reload();
                             showPageLoadingSpinner();
                         }
                         else {
                             alert("Something went wrong")
                         }
                     },
                     failure: function (data) {
                         alert("Try reloading the page");
                     },

                     error: function (data) {
                         console.log("ERROR");
                     }
                 });
             });
    }
</script>
